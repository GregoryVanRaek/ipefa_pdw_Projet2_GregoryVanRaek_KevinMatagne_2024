<main class="p-6">

  <p-button raised severity="secondary" routerLink="/site">
    <i class="pi pi-arrow-left"></i>{{ 'site-feature-detail-back-to-list' | translate }}
  </p-button>

  <h1 class="mb-6">{{ 'site-feature-detail-title' | translate }}</h1>

  @if(isLoading){
    <p-progress-spinner/>
  } @else {
    @if(site$()) {
      <p-tabs value="0">
        <p-tablist>
          <p-tab class="uppercase" value="0">{{ 'site-detail-feature-first-tab' | translate }}</p-tab>
          <p-tab class="uppercase" value="1">{{ 'site-detail-feature-second-tab' | translate }}</p-tab>
        </p-tablist>
        <p-tabpanels>
          <p-tabpanel value="0">
            <form [formGroup]="siteFormGroup" class="flex justify-between flex-wrap md:mx-20" (ngSubmit)="update()">
              <div class="form-section">
                <div class="flex py-4 gap-4 md:my-4 items-center">
                  <h2 class="capitalize lg:mt-4">{{ 'site-detail-feature-address' | translate }}</h2>
                  <p-button outlined raised (click)="onEditClick()" severity="warn">
                    <i class="pi pi-pencil"></i><span class="hidden md:block">{{ 'btn-detail' | translate }}</span>
                  </p-button>
                  <p-button outlined raised (click)="delete()" severity="danger">
                    <i class="pi pi-times"></i><span class="hidden md:block">{{ 'btn-delete' | translate }}</span>
                  </p-button>
                </div>
                <div>
                  <p-floatlabel>
                    <input formControlName="siteName" pInputText id="siteName"/>
                    <label for="siteName">{{ 'site-siteName' | translate }}</label>
                  </p-floatlabel>
                  @if(getErrorMessages('siteName').length > 0 && siteFormGroup.get('siteName')?.touched) {
                    @for(errorMessage of getErrorMessages('lastname') ; track $index) {
                      <p class="error-msg">{{ errorMessage }}</p>
                    }
                  }
                </div>
                <div class="py-10" >
                  <p-floatlabel>
                    <input formControlName="comment" pInputText id="comment" />
                    <label for="comment">{{ 'site-comment' | translate }}</label>
                  </p-floatlabel>
                  @if(getErrorMessages('comment').length > 0 && addressForm.get('comment')?.touched) {
                    @for(errorMessage of getErrorMessages('comment') ; track $index) {
                      <p class="error-msg">{{ errorMessage }}</p>
                    }
                  }
                </div>
              </div>
              <div class="form-section">
                <h2 class="capitalize lg:mt-4">{{ 'staff-detail-feature-address' | translate }}</h2>
                <div formGroupName="address">
                  <div class="my-8 flex gap-6 flex-wrap">
                    <div>
                      <p-floatlabel>
                        <input formControlName="road" pInputText id="road" />
                        <label for="road">{{ 'address-road' | translate }}</label>
                      </p-floatlabel>
                      @if(getErrorMessages('road').length > 0 && addressForm.get('road')?.touched) {
                        @for(errorMessage of getErrorMessages('road') ; track $index) {
                          <p class="error-msg">{{ errorMessage }}</p>
                        }
                      }
                    </div>
                    <div>
                      <p-floatlabel>
                        <input formControlName="nb" pInputText id="nb" />
                        <label for="nb">{{ 'address-nb' | translate }}</label>
                      </p-floatlabel>
                      @if(getErrorMessages('nb').length > 0 && addressForm.get('nb')?.touched) {
                        @for(errorMessage of getErrorMessages('nb') ; track $index) {
                          <p class="error-msg">{{ errorMessage }}</p>
                        }
                      }
                    </div>
                  </div>
                  <div class="my-8 flex gap-6 flex-wrap">
                    <div>
                      <p-floatlabel>
                        <input formControlName="cp" pInputText id="cp" />
                        <label for="cp">{{ 'address-cp' | translate }}</label>
                      </p-floatlabel>
                      @if(getErrorMessages('cp').length > 0 && addressForm.get('cp')?.touched) {
                        @for(errorMessage of getErrorMessages('cp') ; track $index) {
                          <p class="error-msg">{{ errorMessage }}</p>
                        }
                      }
                    </div>
                    <div>
                      <p-floatlabel>
                        <input formControlName="town" pInputText id="town" />
                        <label for="town">{{ 'address-town' | translate }}</label>
                      </p-floatlabel>
                      @if(getErrorMessages('town').length > 0 && addressForm.get('town')?.touched) {
                        @for(errorMessage of getErrorMessages('town') ; track $index) {
                          <p class="error-msg">{{ errorMessage }}</p>
                        }
                      }
                    </div>
                  </div>
                  <div class="my-8 flex gap-6 flex-wrap">
                    <div>
                      <p-floatlabel>
                        <input formControlName="country" pInputText id="country" />
                        <label for="country">{{ 'address-country' | translate }}</label>
                      </p-floatlabel>
                      @if(getErrorMessages('country').length > 0 && addressForm.get('country')?.touched) {
                        @for(errorMessage of getErrorMessages('country') ; track $index) {
                          <p class="error-msg">{{ errorMessage }}</p>
                        }
                      }
                    </div>
                  </div>
                  <p-floatlabel>
                    <input class="w-full" formControlName="complements" pInputText id="complements" />
                    <label for="complements">{{ 'address-complements' | translate }}</label>
                  </p-floatlabel>
                </div>

                @if(isEditMode) {
                  <div class="mt-4 flex gap-4">
                    <p-button outlined raised type="submit" [disabled]="!siteFormGroup.valid || !addressForm.valid "><i class="pi pi-save"></i>{{ 'btn-save' | translate }}</p-button>
                    <p-button outlined raised (click)="onEditClick()" severity="danger"><i class="pi pi-times"></i><span>{{ 'btn-cancel' | translate }}</span></p-button>
                  </div>
                }
              </div>
            </form>
          </p-tabpanel>
          <p-tabpanel value="1">
            <div class="md:mx-20">
              <div class="flex gap-4 items-center">
                @if(!this.newInvoice) {
                  <h2 class="capitalize my-4">{{ 'site-detail-feature-second-tab' | translate }}</h2>
                  <p-button outlined raised (click)="newInvoiceOnClick()">
                    <i class="pi pi-plus"></i>{{ 'btn-create' | translate }}
                  </p-button>
                } @else {
                  <h2 class="capitalize my-4">{{ 'site-detail-feature-second-tab' | translate }}</h2>
                  <p-button severity="danger" (click)="newInvoiceOnClick()">
                    <i class="pi pi-times"></i>{{ 'btn-cancel' | translate }}
                  </p-button>
                }
              </div>
              @if(this.newInvoice) {
                <app-invoice-create-page [siteId]="siteId"></app-invoice-create-page>
              } @else {
                <app-invoice-overview-page [siteId]="siteId"></app-invoice-overview-page>
              }
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    }
  }
  <p-toast />
  <p-confirmDialog />
</main>
